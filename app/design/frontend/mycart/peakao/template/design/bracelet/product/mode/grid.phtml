<?php /* @var $this Ikantam_Diamonds_Block_Product_List_Diamonds */ ?>
<?php
$_productCollection = $this->getProductCollection();
$_helper = $this->helper('catalog/output');
$_diamondsHelper = $this->helper('diamonds/bracelets');
/*echo $_productCollection->getSelect();*/
?>
<?php $mode = $this->getMode(); ?>

<?php if (!$_productCollection->count()): ?>
    <p class="note-msg">
        <?php echo $this->__('There are no products matching the selection.') ?>
    </p>
<?php else: ?>

  
  <?php echo $this->getChildHtml("toolbar_top"); ?>
 <div class="tab-list-content-wrap">
    <?php if ($mode == 'grid'): ?>
        <?php //Grid mode ?>
           
      <div id="tab-grid" class="diamond-grid-list">
<div class="search-content">
<ul class="search-list-wrap clearfix">
    <?php // Grid Mode  ?>
                    <?php $_collectionSize = $_productCollection->count() ?>
                    <?php $_columnCount = 4; //$this->getColumnCount(); ?>
                    <?php $i = 0;
                    foreach ($_productCollection as $_product):
                        ?>
			<li>
			<div class="slider-small search-item">
			<figure>
			<div data-id="<?php echo $_product->getId() ?>" class="viewbutton quick_view_trigger">快速欣賞</div>
			<a
			href="<?php echo $_diamondsHelper->getDiamondUrl($_product); ?>"
			title="<?php echo $this->stripTags($this->getImageLabel($_product, 'image'), null, true) ?>"
			class="product-image" style="height: 100%; width: 100%;"
			id="product_<?php echo $_product->getId() ?>">

			<img alt="diamond" src="<?php echo $this->getskinurl("images")?>/search-diamond.png" />
				
			</a>
			</figure>
			<h3><a href="<?php echo $_diamondsHelper->getDiamondUrl($_product); ?>"
			 title="<?php echo $this->stripTags($_product->getName(), null, true) ?>">
			 <?php echo $_helper->productAttribute($_product, $_product->getName(), 'name') ?>
			 </a>
			 </h3>
			<span class="diamond-properties"> 
			<span><?php
$carat = sprintf("%.2f",$_product->getResource()->getAttribute('carat')->getFrontend()->getValue($_product));
			echo $carat?> 克拉</span> 
			<span>圓形鑽石成色:<?php echo $_product->getResource()->getAttribute('color_loose')->getFrontend()->getValue($_product)?></span> 
			<span>淨度: <?php echo $_product->getResource()->getAttribute('clarity')->getFrontend()->getValue($_product)?> </span> 
			<span>切割: <?php echo $_product->getResource()->getAttribute('cut')->getFrontend()->getValue($_product)?></span></span>
			<div class="star-label clearfix"><span class="rating">4.2</span>
			<div class="star-wrap"><span>(共有3個評慏）</span></div>
			</div>
			<span class="norm"><?php echo Mage::helper("core")->currency($_product->getFinalPrice()) ?>
			</span>

		  <?php echo $this->getChild("addtocompare")->setProduct($_product)->toHtml(); ?></div>
	<!--		<a class="rotate-deg" href="#"> 
			<img alt="360" src="<?php // echo $this->getskinurl("images")?>/360-deg.png" /></a> -->
			</li>
			<?php endforeach ?>
			</ul>
			</div>
			</div>


    <?php elseif ($mode == "comparison"): ?>
        <?php //List mode  ?>
<div id="tab-list" class="diamond-search-list">
<ul class="list-header-diamond head-l clearfix">
<li class="list-one">形狀</li>
<li class="list-two">克拉重量</li>
<li class="list-three">切割</li>
<li class="list-four">顏色</li>
<li class="list-five">淨度</li>
<li class="list-six">拋光</li>
<li class="list-seven">對稱</li>
<li class="list-eight">螢光</li>
<li class="list-nine">價格</li>
<li class="list-ten">比較</li>
</ul>
  <?php foreach ($_productCollection as $_product): 
  $_product=Mage::getModel("catalog/product")->load($_product->getId());
  ?>
<ul data-id="<?php echo $_product->getId() ?>" class="viewbutton list-header-diamond  listing-content-list clearfix">
<li class="list-one">
<img alt="" src="<?php echo $this->getskinurl("images")?>/diamond-small.png" />
<img class="big-deg" alt="" src="<?php echo $this->getskinurl("images")?>/360-deg-big.png" />
</li>
<li class="list-two">
<?php
$carat = sprintf("%.2f",$_product->getResource()->getAttribute('carat')->getFrontend()->getValue($_product));
 echo $carat?>克拉</li>
<li class="list-three"><?php echo $_product->getResource()->getAttribute('cut')->getFrontend()->getValue($_product) ?></li>
<li class="list-four"><?php echo $_product->getResource()->getAttribute('color_loose')->getFrontend()->getValue($_product) ?></li>
<li class="list-five"><?php echo $_product->getResource()->getAttribute('clarity')->getFrontend()->getValue($_product) ?></li>
<li class="list-six"><?php echo $_product->getResource()->getAttribute('polish')->getFrontend()->getValue($_product) ?></li>
<li class="list-seven"><?php echo $_product->getResource()->getAttribute('symmetry')->getFrontend()->getValue($_product) ?></li>
<li class="list-eight"><?php echo $_product->getResource()->getAttribute('fluorescence')->getFrontend()->getValue($_product) ?></li>
<li class="list-nine"><?php echo Mage::helper("core")->currency($_product->getFinalPrice(),true,false) ?></li>
<li class="list-ten compare">
  <?php echo $this->getChild("addtocompare")->setProduct($_product)->toHtml(); ?>
</li>
<script type="text/javascript">
  jQuery(".list-ten.compare").click(function(e){e.stopPropagation();});
</script>
</ul>
     <?php endforeach; ?>
<div class="banner-bottom">
<figure><img alt="" src="<?php echo $this->getskinurl("images")?>/search-banner-bottom.jpg" /></figure>
</div>
</div>
    <?php endif; ?>  <!--  <div class="toolbar css3"><?php //echo $this->getToolbarHtml(); ?></div>-->
	  </div>
	  
	   
    <script type="text/javascript">

            jQuery(function($) {
				$(".viewbutton").click(function(){
			     var id =$(this).attr("data-id");
					if($("#absoluteDiv"+id).length=="0"){
						         jQuery(".overlayBlock").show();	
						$.ajax({
								 type: 'GET',
								 url: '<?php echo $this->geturl("design/earrings_quickview/view/part/diamond")?>' ,
								 data: "id="+id,
								 success: function(data){
								$("body").append(data); 
								  
								 } ,
								dataType: "json"
							});	
							
					}
					else {
						$("#absoluteDiv"+id).show();
					}
					
				});
            });

            jQuery( function($) {
                $('tbody tr[data-href]').addClass('clickable');

                $('.clickable').children('td').click( function() {
                    var elem = $(this);
                    if(elem.find('.add-to-compare').length > 0){
                        return;
                    }
                    window.location = elem.parent().attr('data-href');
                }).find('a').hover( function() {
                    $(this).parents('td').unbind('click');
                }, function() {
                    $(this).parents('td').click( function() {
                        var elem = $(this);
                        if(elem.find('.add-to-compare').length > 0){
                            return;
                        }
                        window.location = elem.parent().attr('data-href');
                    });
                });
            });
        </script>
<?php endif; ?>